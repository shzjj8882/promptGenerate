# AILY é¡¹ç›®

AILY æ˜¯ä¸€ä¸ªåŸºäº AI çš„æ™ºèƒ½æç¤ºè¯ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šåœºæ™¯ã€å¤šç§Ÿæˆ·çš„æç¤ºè¯ç®¡ç†å’Œ LLM å¯¹è¯åŠŸèƒ½ã€‚

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

AILY é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæä¾›ï¼š
- **æç¤ºè¯ç®¡ç†**ï¼šæ”¯æŒå¤šåœºæ™¯ï¼ˆè°ƒç ”ã€PPTæŠ¥å‘Šã€é”€å”®æ‰“å•ç­‰ï¼‰çš„æç¤ºè¯é…ç½®å’Œç®¡ç†
- **å ä½ç¬¦ç³»ç»Ÿ**ï¼šçµæ´»çš„å ä½ç¬¦é…ç½®ï¼Œæ”¯æŒåŠ¨æ€æ•°æ®æ³¨å…¥
- **RAG ç®¡ç†**ï¼šä¼ä¸šçŸ¥è¯†åº“ï¼ˆRAGï¼‰é…ç½®å’Œç®¡ç†
- **RBAC æƒé™**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œæ”¯æŒèœå•æƒé™å’Œæ¥å£æƒé™
- **LLM å¯¹è¯**ï¼šé›†æˆ DeepSeek APIï¼Œæ”¯æŒæµå¼å’Œéæµå¼å¯¹è¯
- **é”€å”®æ‰“å•**ï¼šé”€å”®è®¢å•åˆ†æã€DMU æŠ¥å‘Šç”Ÿæˆç­‰åŠŸèƒ½

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
aily_projects/
â”œâ”€â”€ service/          # åç«¯æœåŠ¡ï¼ˆFastAPIï¼‰
â”‚   â”œâ”€â”€ app/         # åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ scripts/     # æ•°æ®åº“è¿ç§»å’Œå·¥å…·è„šæœ¬
â”‚   â””â”€â”€ main.py      # åº”ç”¨å…¥å£
â”œâ”€â”€ app/             # å‰ç«¯åº”ç”¨ï¼ˆNext.jsï¼‰
â”‚   â”œâ”€â”€ app/         # Next.js App Router é¡µé¢
â”‚   â”œâ”€â”€ components/  # React ç»„ä»¶
â”‚   â”œâ”€â”€ lib/         # å·¥å…·åº“å’Œ API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ hooks/       # React Hooks
â”œâ”€â”€ docker/          # Docker é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ docker-compose.yml    # Docker Compose é…ç½®ï¼ˆåŒ…å«æ•°æ®åº“ã€Redisã€åç«¯æœåŠ¡ã€å‰ç«¯åº”ç”¨ï¼‰
â”‚   â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”œâ”€â”€ service/              # åç«¯æœåŠ¡ Dockerfile
â”‚   â”‚   â””â”€â”€ Dockerfile
â”‚   â”œâ”€â”€ app/                  # å‰ç«¯åº”ç”¨ Dockerfile
â”‚   â”‚   â””â”€â”€ Dockerfile
â”‚   â”œâ”€â”€ Makefile              # ä¾¿æ·å‘½ä»¤è„šæœ¬
â”‚   â””â”€â”€ README.md             # Docker éƒ¨ç½²è¯´æ˜
â””â”€â”€ README.md        # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

### æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- FastAPI - å¼‚æ­¥ Web æ¡†æ¶
- SQLAlchemy - ORM æ¡†æ¶
- PostgreSQL - å…³ç³»å‹æ•°æ®åº“
- Redis - ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- asyncpg - å¼‚æ­¥ PostgreSQL é©±åŠ¨
- python-jose - JWT è®¤è¯
- httpx - HTTP å®¢æˆ·ç«¯ï¼ˆLLM API è°ƒç”¨ï¼‰

**å‰ç«¯**ï¼š
- Next.js 16 - React æ¡†æ¶ï¼ˆApp Routerï¼‰
- TypeScript - ç±»å‹å®‰å…¨
- Tailwind CSS - æ ·å¼æ¡†æ¶
- Radix UI - æ— éšœç¢ UI ç»„ä»¶åº“
- MobX - çŠ¶æ€ç®¡ç†
- React Hook Form - è¡¨å•ç®¡ç†
- TanStack Table - è¡¨æ ¼ç»„ä»¶

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

### åç«¯æœåŠ¡ (`service/`)

```
service/
â”œâ”€â”€ app/                          # åº”ç”¨æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒé…ç½®å’Œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.py            # åº”ç”¨é…ç½®ï¼ˆç¯å¢ƒå˜é‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“è¿æ¥å’Œ Redis é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.py              # è®¤è¯ä¾èµ–ï¼ˆJWTï¼‰
â”‚   â”‚   â”œâ”€â”€ permissions.py       # æƒé™æ£€æŸ¥ä¾èµ–
â”‚   â”‚   â”œâ”€â”€ cache.py             # ç¼“å­˜å·¥å…·ï¼ˆRedisï¼‰
â”‚   â”‚   â”œâ”€â”€ middleware.py        # ä¸­é—´ä»¶ï¼ˆè¯·æ±‚IDã€å®¡è®¡æ—¥å¿—ï¼‰
â”‚   â”‚   â”œâ”€â”€ response.py         # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ security.py         # å¯†ç åŠ å¯†ã€Token ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ seed_scenes.py      # é¢„ç½®åœºæ™¯åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ team_filter.py      # å›¢é˜Ÿè¿‡æ»¤å·¥å…·
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹ï¼ˆSQLAlchemyï¼‰
â”‚   â”‚   â”œâ”€â”€ user.py             # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ team.py             # å›¢é˜Ÿæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ prompt.py           # æç¤ºè¯ã€å ä½ç¬¦ã€ç§Ÿæˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ scene.py            # åœºæ™¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ rbac.py             # è§’è‰²ã€æƒé™æ¨¡å‹
â”‚   â”‚   â””â”€â”€ sales_order.py      # é”€å”®è®¢å•æ¨¡å‹ï¼ˆDMUæŠ¥å‘Šã€å®¢æˆ·å†å²ï¼‰
â”‚   â”œâ”€â”€ schemas/                 # Pydantic æ¨¡å‹ï¼ˆè¯·æ±‚/å“åº”ï¼‰
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ prompt.py
â”‚   â”‚   â”œâ”€â”€ rbac.py
â”‚   â”‚   â”œâ”€â”€ rag.py
â”‚   â”‚   â”œâ”€â”€ sales_order.py
â”‚   â”‚   â””â”€â”€ team.py
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ user_service.py     # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ prompt_service.py   # æç¤ºè¯ã€å ä½ç¬¦ã€ç§Ÿæˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ scene_service.py    # åœºæ™¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rag_service.py      # RAG ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rbac_service.py     # è§’è‰²æƒé™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ team_service.py     # å›¢é˜Ÿç®¡ç†
â”‚   â”‚   â”œâ”€â”€ sales_order_service.py  # é”€å”®è®¢å•æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ llm_service.py       # LLM API è°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ conversation_context_service.py  # å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ placeholder_methods.py  # å ä½ç¬¦æ•°æ®è·å–æ–¹æ³•
â”‚   â”‚   â””â”€â”€ placeholder_methods_registry.py  # å ä½ç¬¦æ–¹æ³•æ³¨å†Œ
â”‚   â”œâ”€â”€ routers/                  # è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ admin/               # ç®¡ç†æ¥å£ï¼ˆéœ€è¦è®¤è¯ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py         # è®¤è¯æ¥å£ï¼ˆæ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·ç®¡ç†ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.py      # æç¤ºè¯ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ scenes.py       # åœºæ™¯ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ tenants.py      # ç§Ÿæˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ rag.py          # RAG ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ rbac.py         # è§’è‰²æƒé™ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ teams.py        # å›¢é˜Ÿç®¡ç†
â”‚   â”‚   â””â”€â”€ api/                 # åº”ç”¨æ¥å£ï¼ˆå¯é€‰è®¤è¯ï¼‰
â”‚   â”‚       â”œâ”€â”€ llmchat.py      # LLM å¯¹è¯æ¥å£
â”‚   â”‚       â””â”€â”€ sales_order.py  # é”€å”®è®¢å•æ¥å£
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ dmu_extractor.py    # DMU æ•°æ®æå–å·¥å…·
â”œâ”€â”€ scripts/                       # æ•°æ®åº“è¿ç§»å’Œå·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ init_db.py               # åˆå§‹åŒ–æ•°æ®åº“
â”‚   â”œâ”€â”€ migrate_*.py             # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ check_*.py               # æ•°æ®æ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ cleanup_*.py             # æ•°æ®æ¸…ç†è„šæœ¬
â”‚   â”œâ”€â”€ delete_*.py              # æ•°æ®åˆ é™¤è„šæœ¬
â”‚   â””â”€â”€ set_superuser.py         # è®¾ç½®è¶…çº§ç®¡ç†å‘˜
â”œâ”€â”€ main.py                       # FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt              # Python ä¾èµ–
â”œâ”€â”€ env.template                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ start.sh                      # å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md                     # åç«¯è¯´æ˜æ–‡æ¡£
```

### å‰ç«¯åº”ç”¨ (`app/`)

```
app/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                  # è®¤è¯ç›¸å…³é¡µé¢ï¼ˆç™»å½•ã€æ³¨å†Œï¼‰
â”‚   â”œâ”€â”€ dashboard/               # ç®¡ç†åå°é¡µé¢
â”‚   â”‚   â”œâ”€â”€ prompts/            # æç¤ºè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ scenes/             # åœºæ™¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tenants/           # ç§Ÿæˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rag/                # RAG ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rbac/               # æƒé™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ teams/              # å›¢é˜Ÿç®¡ç†
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ page.tsx            # é¦–é¡µ
â”‚   â””â”€â”€ layout.tsx               # æ ¹å¸ƒå±€
â”œâ”€â”€ components/                   # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                      # åŸºç¡€ UI ç»„ä»¶ï¼ˆRadix UI å°è£…ï¼‰
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ shared/                  # å…±äº«ä¸šåŠ¡ç»„ä»¶
â”‚       â”œâ”€â”€ action-buttons.tsx   # æ“ä½œæŒ‰é’®ï¼ˆç¼–è¾‘/åˆ é™¤ï¼‰
â”‚       â”œâ”€â”€ dashboard-nav.tsx    # å¯¼èˆªèœå•
â”‚       â”œâ”€â”€ page-header.tsx      # é¡µé¢å¤´éƒ¨
â”‚       â”œâ”€â”€ theme-toggle.tsx     # ä¸»é¢˜åˆ‡æ¢
â”‚       â””â”€â”€ ...
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ api/                     # API å®¢æˆ·ç«¯ï¼ˆå®¢æˆ·ç«¯è°ƒç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ config.ts           # API é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯ API
â”‚   â”‚   â”œâ”€â”€ prompts.ts          # æç¤ºè¯ API
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ server-api/              # æœåŠ¡ç«¯ APIï¼ˆSSR è°ƒç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ prompts.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ permissions.ts           # æƒé™å·¥å…·
â”‚   â”œâ”€â”€ constants.ts             # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ error.ts            # é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ format.ts           # æ ¼å¼åŒ–å·¥å…·
â”‚       â””â”€â”€ logger.ts           # æ—¥å¿—å·¥å…·
â”œâ”€â”€ hooks/                        # React Hooks
â”‚   â”œâ”€â”€ use-pagination.ts       # åˆ†é¡µ Hook
â”‚   â”œâ”€â”€ use-search.ts           # æœç´¢ Hook
â”‚   â”œâ”€â”€ use-error-handler.ts    # é”™è¯¯å¤„ç† Hook
â”‚   â””â”€â”€ ...
â”œâ”€â”€ store/                        # çŠ¶æ€ç®¡ç†ï¼ˆMobXï¼‰
â”‚   â”œâ”€â”€ user-store.ts           # ç”¨æˆ·çŠ¶æ€
â”‚   â””â”€â”€ ui-store.ts             # UI çŠ¶æ€
â”œâ”€â”€ tests/                        # å•å…ƒæµ‹è¯•
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”œâ”€â”€ package.json                  # ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â””â”€â”€ README.md                     # å‰ç«¯è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.9+
- Node.js 18+
- PostgreSQL 12+
- Redis 6+

### åç«¯å¯åŠ¨

```bash
cd service

# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp env.template .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’Œ Redis è¿æ¥ä¿¡æ¯

# 4. åˆå§‹åŒ–æ•°æ®åº“
python3 scripts/init_db.py

# 5. æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼ˆæŒ‰éœ€ï¼‰
python3 scripts/migrate_tenants.py
python3 scripts/migrate_rbac.py
python3 scripts/migrate_scenes.py
# ... å…¶ä»–è¿ç§»è„šæœ¬

# 6. å¯åŠ¨æœåŠ¡
./start.sh
# æˆ–æ‰‹åŠ¨å¯åŠ¨
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

æœåŠ¡å¯åŠ¨åè®¿é—®ï¼š
- API æ–‡æ¡£ï¼šhttp://localhost:8000/docs
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8000/health

### å‰ç«¯å¯åŠ¨

```bash
cd app

# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
# åˆ›å»º .env.local æ–‡ä»¶ï¼Œé…ç½® NEXT_PUBLIC_API_BASE_URL
# é»˜è®¤ä½¿ç”¨ http://localhost:8000

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

å‰ç«¯å¯åŠ¨åè®¿é—®ï¼šhttp://localhost:3000

## ğŸ“š æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†

- **ç”¨æˆ·ç®¡ç†**ï¼šæ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- **RBAC æƒé™**ï¼šè§’è‰²ã€æƒé™ã€ç”¨æˆ·è§’è‰²åˆ†é…
- **å›¢é˜Ÿç®¡ç†**ï¼šå¤šå›¢é˜Ÿæ”¯æŒï¼Œå›¢é˜Ÿç®¡ç†å‘˜æƒé™
- **JWT è®¤è¯**ï¼šToken è®¤è¯ï¼Œæ”¯æŒåˆ·æ–°

### 2. æç¤ºè¯ç®¡ç†

- **å¤šåœºæ™¯æ”¯æŒ**ï¼šè°ƒç ”ã€PPTæŠ¥å‘Šã€é”€å”®æ‰“å•ç­‰
- **å ä½ç¬¦ç³»ç»Ÿ**ï¼šåŠ¨æ€å ä½ç¬¦é…ç½®å’Œæ•°æ®æ³¨å…¥
- **ç§Ÿæˆ·éš”ç¦»**ï¼šæ¯ä¸ªç§Ÿæˆ·å¯é…ç½®ç‹¬ç«‹çš„æç¤ºè¯
- **é»˜è®¤æç¤ºè¯**ï¼šæ”¯æŒå…¨å±€å’Œå›¢é˜Ÿçº§åˆ«çš„é»˜è®¤æç¤ºè¯

### 3. RAG ç®¡ç†

- **ä¼ä¸šçŸ¥è¯†åº“**ï¼šRAG é…ç½®å’Œç®¡ç†
- **ç§Ÿæˆ·å…³è”**ï¼šRAG ä¸ç§Ÿæˆ·å…³è”
- **å›¢é˜Ÿéš”ç¦»**ï¼šå›¢é˜Ÿçº§åˆ«çš„ RAG ç®¡ç†

### 4. LLM å¯¹è¯

- **æµå¼å¯¹è¯**ï¼šæ”¯æŒæµå¼å“åº”
- **å ä½ç¬¦å¤„ç†**ï¼šè‡ªåŠ¨å¤„ç†æç¤ºè¯ä¸­çš„å ä½ç¬¦
- **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šå¯¹è¯ä¸Šä¸‹æ–‡å­˜å‚¨ï¼ˆRedis + å†…å­˜é™çº§ï¼‰
- **DeepSeek é›†æˆ**ï¼šé›†æˆ DeepSeek API

### 5. é”€å”®æ‰“å•

- **DMU åˆ†æ**ï¼šå†³ç­–å•å…ƒï¼ˆDMUï¼‰åˆ†æ
- **å®¢æˆ·å†å²**ï¼šå®¢æˆ·å†å²æ•°æ®ç®¡ç†
- **æŠ¥å‘Šç”Ÿæˆ**ï¼šDMU æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆå’Œä¿å­˜

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

- **users** - ç”¨æˆ·è¡¨
- **teams** - å›¢é˜Ÿè¡¨
- **scenes** - åœºæ™¯è¡¨ï¼ˆé¢„ç½®åœºæ™¯ï¼šresearchã€ppt_reportã€sales_orderï¼‰
- **prompts** - æç¤ºè¯è¡¨
- **placeholders** - å ä½ç¬¦è¡¨
- **tenants** - ç§Ÿæˆ·è¡¨
- **rags** - RAG é…ç½®è¡¨
- **roles** - è§’è‰²è¡¨
- **permissions** - æƒé™è¡¨
- **user_roles** - ç”¨æˆ·è§’è‰²å…³è”è¡¨
- **role_permissions** - è§’è‰²æƒé™å…³è”è¡¨
- **dmu_reports** - DMU æŠ¥å‘Šè¡¨
- **customer_history** - å®¢æˆ·å†å²è¡¨

### å¤–é”®å…³ç³»

- `users.team_id` â†’ `teams.id`
- `prompts.scene_id` â†’ `scenes.id`
- `prompts.team_id` â†’ `teams.id`
- `placeholders.scene_id` â†’ `scenes.id`
- `tenants.team_id` â†’ `teams.id`
- `tenants.created_by` â†’ `users.id`
- `rags.team_id` â†’ `teams.id`
- `rags.created_by` â†’ `users.id`

## ğŸ”§ å¼€å‘æŒ‡å—

### åç«¯å¼€å‘

1. **æ·»åŠ æ–°æ¥å£**ï¼š
   - åœ¨ `app/routers/admin/` æˆ– `app/routers/api/` ä¸­æ·»åŠ è·¯ç”±
   - åœ¨å¯¹åº”çš„ `services/` ä¸­æ·»åŠ ä¸šåŠ¡é€»è¾‘
   - åœ¨ `schemas/` ä¸­å®šä¹‰è¯·æ±‚/å“åº”æ¨¡å‹

2. **æ•°æ®åº“è¿ç§»**ï¼š
   - åœ¨ `scripts/` ç›®å½•åˆ›å»ºè¿ç§»è„šæœ¬
   - ä½¿ç”¨ `asyncpg` ç›´æ¥æ‰§è¡Œ SQL
   - å‚è€ƒç°æœ‰è¿ç§»è„šæœ¬çš„æ ¼å¼

3. **ç¼“å­˜ä½¿ç”¨**ï¼š
   - ä½¿ç”¨ `app/core/cache.py` ä¸­çš„ç¼“å­˜å·¥å…·
   - ç»Ÿä¸€ç®¡ç†ç¼“å­˜ key å‰ç¼€å’Œ TTL
   - ç¡®ä¿ç¼“å­˜å¤±æ•ˆé€»è¾‘æ­£ç¡®

### å‰ç«¯å¼€å‘

1. **æ·»åŠ æ–°é¡µé¢**ï¼š
   - åœ¨ `app/dashboard/` ä¸‹åˆ›å»ºé¡µé¢ç›®å½•
   - ä½¿ç”¨ `page.tsx` ä½œä¸ºé¡µé¢å…¥å£ï¼ˆSSRï¼‰
   - ä½¿ç”¨ `*-client.tsx` ä½œä¸ºå®¢æˆ·ç«¯ç»„ä»¶

2. **API è°ƒç”¨**ï¼š
   - å®¢æˆ·ç«¯è°ƒç”¨ï¼šä½¿ç”¨ `lib/api/` ä¸­çš„ API å®¢æˆ·ç«¯
   - æœåŠ¡ç«¯è°ƒç”¨ï¼šä½¿ç”¨ `lib/server-api/` ä¸­çš„ API å®¢æˆ·ç«¯

3. **ç»„ä»¶å¼€å‘**ï¼š
   - UI ç»„ä»¶æ”¾åœ¨ `components/ui/`
   - ä¸šåŠ¡ç»„ä»¶æ”¾åœ¨ `components/shared/`
   - é¡µé¢ç‰¹å®šç»„ä»¶æ”¾åœ¨å¯¹åº”é¡µé¢ç›®å½•ä¸‹

## ğŸ“– ç›¸å…³æ–‡æ¡£

é¡¹ç›®æ–‡æ¡£ç»Ÿä¸€åœ¨æ ¹ç›®å½• README.md ä¸­ç»´æŠ¤ï¼Œå„å­ç›®å½•ä¸å†å•ç‹¬ç»´æŠ¤ README æ–‡ä»¶ã€‚

## ğŸ”’ å®‰å…¨è¯´æ˜

- **JWT è®¤è¯**ï¼šæ‰€æœ‰ç®¡ç†æ¥å£éœ€è¦ Token è®¤è¯
- **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
- **API Key**ï¼šåº”ç”¨æ¥å£ï¼ˆ`/api`ï¼‰æ”¯æŒå¯é€‰çš„ API Key è®¤è¯
- **CORS é…ç½®**ï¼šæ”¯æŒè·¨åŸŸé…ç½®
- **æƒé™æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„ç»†ç²’åº¦æƒé™æ§åˆ¶

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

### åç«¯ç¯å¢ƒå˜é‡ï¼ˆ`service/.env`ï¼‰

```bash
# åº”ç”¨é…ç½®
DEBUG=False
ENV=development  # development | production
SECRET_KEY=your-secret-key-here-change-in-production

# æ•°æ®åº“é…ç½®
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=aily_db

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# CORS é…ç½®
CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# DeepSeek API é…ç½®
DEEPSEEK_API_KEY=your-api-key
DEEPSEEK_API_BASE=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# API Keyï¼ˆå¯é€‰ï¼‰
API_KEY=
```

### å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆ`app/.env.local`ï¼‰

```bash
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
```

## ğŸ§ª æµ‹è¯•

### åç«¯æµ‹è¯•

```bash
cd service
# è¿è¡Œæµ‹è¯•è„šæœ¬
python3 scripts/check_*.py
```

### å‰ç«¯æµ‹è¯•

```bash
cd app
# è¿è¡Œå•å…ƒæµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage
```

## ğŸ“¦ éƒ¨ç½²

### Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†å®Œæ•´çš„ Docker é…ç½®ï¼ŒåŒ…å«æ•°æ®åº“ã€Redisã€åç«¯æœåŠ¡ã€å‰ç«¯åº”ç”¨å’Œ Nginx åå‘ä»£ç†ï¼š

```bash
cd docker

# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å¯†ç ã€API Key ç­‰

# 2. æ„å»ºé•œåƒ
make build
# æˆ–
docker-compose build

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
make up
# æˆ–
docker-compose up -d

# 4. åˆå§‹åŒ–æ•°æ®åº“
make init-db
make migrate SCRIPT=migrate_tenants.py
make migrate SCRIPT=migrate_rbac.py
make migrate SCRIPT=migrate_scenes.py
```

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯åº”ç”¨: http://localhost:3000
- åç«¯ API: http://localhost:3000/apiï¼ˆé€šè¿‡ Next.js rewrites ä»£ç†ï¼‰
- API æ–‡æ¡£: http://localhost:3000/docsï¼ˆé€šè¿‡ Next.js rewrites ä»£ç†ï¼‰

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [docker/README.md](./docker/README.md)

### ä¼ ç»Ÿéƒ¨ç½²

#### åç«¯éƒ¨ç½²

1. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
2. æ‰§è¡Œæ•°æ®åº“è¿ç§»
3. ä½¿ç”¨ `uvicorn` æˆ– `gunicorn` å¯åŠ¨æœåŠ¡
4. é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰

#### å‰ç«¯éƒ¨ç½²

1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š`pnpm build`
2. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ï¼š`pnpm start`
3. æˆ–éƒ¨ç½²åˆ° Vercel/å…¶ä»–å¹³å°

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

[æ·»åŠ è®¸å¯è¯ä¿¡æ¯]

## ğŸ‘¥ å›¢é˜Ÿ

[æ·»åŠ å›¢é˜Ÿä¿¡æ¯]

---

**æ³¨æ„**ï¼šè¯¦ç»†çš„ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒå„å­ç›®å½•çš„ README æ–‡ä»¶ã€‚
